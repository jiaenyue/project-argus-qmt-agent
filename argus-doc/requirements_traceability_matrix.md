好的，遵照您的指示，以下是完整的、不含省略和变更标记的最终版需求矩阵文档。

---

## 需求矩阵文档 (Requirements Traceability Matrix)

**项目名称:** Project Argus: 天枢计划
**文档版本:** V1.1
**编制人:** 项目经理 (PM)
**日期:** 2023-10-28

### 1. 文档目的

本文档旨在明确并记录“高质量A股数据管道系统”项目的所有需求，包括业务需求、功能需求、非功能性需求及技术约束。通过建立一个可追溯的矩阵，我们将每个需求与项目计划中的设计、开发、测试任务及最终交付价值相关联，以确保项目范围得到有效控制，所有交付成果均满足预期目标。

### 2. 修订历史

| 版本 | 日期 | 修订人 | 修订说明 |
| :--- | :--- | :--- | :--- |
| V1.0 | 2023-10-27 | PM | 初始版本创建。 |
| V1.1 | 2023-10-28 | PM | 明确了数据源战略：以miniQMT为主数据源，Tushare Pro为补充和备份数据源，更新了相关需求描述以体现此核心策略。 |

### 3. 需求分类与优先级定义

*   **需求类别:**
    *   **BR (Business Requirement):** 业务需求，描述项目的高层业务目标和价值。
    *   **FR (Functional Requirement):** 功能需求，描述系统必须具备的具体功能或行为。
    *   **NFR (Non-Functional Requirement):** 非功能性需求，定义系统的质量属性，如性能、可靠性、安全性等。
    *   **TR (Technical Requirement):** 技术与约束需求，描述实施过程中必须遵守的技术标准或限制。
*   **优先级:**
    *   **高 (High):** 项目核心功能，若未实现将导致项目失败。
    *   **中 (Medium):** 重要需求，能显著提升产品价值，但可考虑在后续迭代中增强。
    *   **低 (Low):** 期望实现的需求，对核心功能影响较小，可根据资源情况决定。

### 4. 需求追溯矩阵

#### 4.1 业务需求 (BR)

| 需求ID | 需求描述 | 来源 | 优先级 | 验收标准 | 关联任务ID |
| :--- | :--- | :--- | :--- | :--- | :--- |
| BR-001 | 为NautilusTrader提供工业级的“黄金标准”Parquet数据，支持量化交易。 | 项目愿景 | 高 | 生成的Parquet数据能被NautilusTrader无缝加载并用于回测与实盘。 | P1.2, P3.x, P5.x |
| BR-002 | 以miniQMT为主数据源，通过整合补充数据源Tushare Pro，为核心交易数据填补缺漏并扩展财务、公司行动等关键维度，赋能更复杂的量化策略。 | 核心价值 | 高 | Gold层数据包含财务、公司行动、分析师评级等至少3个新增数据维度，且核心行情数据优先源自miniQMT。 | P1.4, P1.5, P3.x |
| BR-003 | 建立强大的数据质量保障体系，确保数据的可信度，降低策略风险。 | 核心价值 | 高 | 端到端的数据质量评分（月度平均）达到95分以上。 | P1.3, P2.3, P3.x, P4.x |
| BR-004 | 提升数据管道的系统韧性，在主数据源（miniQMT）发生故障时，实现向备用数据源（Tushare Pro）的自动故障转移，保障数据供应的连续性。 | 核心价值 | 高 | 主数据源miniQMT故障时，系统能在2分钟内自动切换到Tushare Pro并完成数据采集。 | P4.2, P5.x |

#### 4.2 功能需求 (FR)

| 需求ID | 需求描述 | 来源 | 优先级 | 验收标准 | 关联任务ID |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **FR-Data Sourcing** | | | | | |
| FR-001 | 系统必须能从主数据源miniQMT采集A股市场的日线及分钟线行情数据。 | 架构图 | 高 | 成功采集99.5%以上交易日的行情数据。 | P2.2, P3.1 |
| FR-002 | 系统必须能从补充数据源Tushare Pro API采集A股数据，用于填补主数据源缺漏及丰富数据维度（如财务、公司行动等）。 | Tushare集成计划 | 高 | Tushare数据采集API调用成功率 > 99.5%，并能按计划分阶段接入各类数据。 | P1.5, P2.2, P3.1 |
| **FR-Data Processing & Fusion** | | | | | |
| FR-003 | 系统需实现Silver层数据处理，包括对原始数据的清洗、格式化和去重。 | 计划书 | 高 | Silver层数据无明显格式错误，重复数据记录为0。 | P3.3 |
| FR-004 | 系统需建立智能数据融合引擎，该引擎必须明确以miniQMT为行情数据（价格、成交量）的主来源。仅在主数据源数据缺失或校验失败时，才使用Tushare行情数据作为回填（Backfill）。对于财务等Tushare独有或质量更优的数据，则以Tushare为主要来源。 | 优先级矩阵 | 高 | 融合逻辑能正确地优先选择miniQMT的行情数据，并在miniQMT数据缺失时，自动、正确地采用Tushare数据进行补充。融合后的数据需记录其来源（`field_source`）。 | P1.4, P3.2 |
| FR-005 | 系统需对来自不同源的数据进行时间轴对齐，确保数据在时间序列上的一致性。 | `EnhancedSilverProcessor` | 高 | 所有时间序列数据（如K线、财务报告日）能精确对齐到交易日。 | P3.3 |
| FR-006 | 系统需具备智能缺失值填补能力，可使用机器学习或统计方法（如均值、插值）处理关键字段的缺失。 | `EnhancedSilverProcessor` | 中 | 关键数值字段（如收盘价）的缺失率在处理后低于0.1%。 | P3.3 |
| **FR-Quality & Monitoring** | | | | | |
| FR-007 | 系统需集成Great Expectations，并建立一个包含至少120条规则的规则库，用于Bronze层和Silver层的数据质量门禁。 | 质量规则库 | 高 | GE质量门禁能自动执行，并在数据质量不达标时中断流水线或发出告警。 | P2.3, P3.5 |
| FR-008 | 系统需实现多源数据一致性监控，定期比对主数据源（miniQMT）和补充数据源（Tushare）的重叠字段（如收盘价），并报告差异。 | 五级监控架构 | 高 | 监控仪表盘能实时展示多源一致性比率。 | P4.2 |
| **FR-Automation & Operation** | | | | | |
| FR-009 | 系统需实现Tushare API的智能配额管理，监控配额使用情况，在接近上限时发出预警，并在耗尽时能触发备用逻辑。 | Tushare配额管理 | 高 | Tushare配额使用率超过90%时触发告警；配额耗尽不会导致数据管道中断。 | P3.4, P4.3 |
| FR-010 | 整个数据处理流程需通过任务调度器进行自动化调度，支持每日定时执行、失败重试和异常处理分支。 | 增强版调度系统 | 高 | 调度系统能按日计划自动运行，任务失败后能自动重试3次。 | P4.1 |
| FR-011 | 系统需将最终的“黄金标准”数据以Parquet格式存储，并按照股票代码和日期进行分区。 | 项目愿景 | 高 | 生成的Parquet文件Schema合规，可被高效查询。 | P3.x |

#### 4.3 非功能性需求 (NFR)

| 需求ID | 需求描述 | 来源 | 优先级 | 验收标准 | 关联任务ID |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **NFR-Performance** | | | | | |
| NFR-001 | 每日全市场数据的端到端处理时间（从采集到入库）应小于60分钟。 | 关键成功指标 | 高 | 性能测试显示，95%的日常处理任务在60分钟内完成。 | P5.x |
| NFR-002 | 数据应用层（NautilusTrader）加载单只股票的全周期历史数据的耗时应小于5秒。 | 五级监控架构 | 中 | 性能测试验证数据加载性能。 | P5.x |
| **NFR-Reliability** | | | | | |
| NFR-003 | 整个数据管道系统的可用性需达到99.9%。 | 关键成功指标 | 高 | 系统年化非计划停机时间小于8.76小时。 | P4.x, P5.x |
| NFR-004 | 数据质量评分（综合完整性、准确性、一致性等）月度平均分不低于95分。 | 质量KPI, 成功指标 | 高 | 质量监控看板显示的月度质量分持续达标。 | P1.3, P4.2 |
| NFR-005 | 主数据源与补充数据源之间的多源数据一致性比率必须高于99%。 | 关键成功指标 | 高 | 一致性监控仪表盘显示比率持续高于99%。 | P4.2 |
| **NFR-Security** | | | | | |
| NFR-006 | 存储的敏感配置信息（如API Token）必须加密。传输过程中的数据应使用HTTPS/TLS加密。 | 安全测试 | 高 | 代码审计和渗透测试未发现明文存储的密钥；网络抓包显示流量加密。 | P5.x |
| **NFR-Maintainability** | | | | | |
| NFR-007 | 系统需提供集中的日志管理，方便快速定位和排查问题。 | 基础设施 | 中 | 所有组件的日志均能被集中采集，并能通过日志查看工具查询。 | P2.1, P4.x |
| NFR-008 | 系统需提供可视化的数据质量监控仪表盘，直观展示核心质量指标和系统健康状况。 | 质量看板设计 | 高 | 监控看板按设计稿实现，数据实时更新。 | P4.2 |

#### 4.4 技术与约束需求 (TR)

| 需求ID | 需求描述 | 来源 | 优先级 | 验收标准 | 关联任务ID |
| :--- | :--- | :--- | :--- | :--- | :--- |
| TR-001 | 系统核心服务需在Windows环境下直接部署，并提供配置文件和启动脚本以便快速部署。 | 环境配置清单 | 高 | 所有服务能通过启动脚本在Windows环境下成功启动。 | P2.1 |
| TR-002 | 核心数据处理和分析库采用Python技术栈，包括Pandas, PyArrow, Great Expectations等。 | 环境配置清单 | 高 | 项目的`requirements.txt`或`pyproject.toml`包含所有指定依赖。 | P2.1 |
| TR-003 | 自动化调度工具使用Windows任务调度器或Python调度库。 | 基础设施 | 高 | 所有的ETL任务都能按计划自动执行和管理。 | P2.1, P4.1 |
| TR-004 | 最终交付的数据格式必须为列式存储的Parquet格式。 | 项目愿景 | 高 | Gold层输出文件为`.parquet`后缀，且符合Parquet规范。 | P3.x |
| TR-005 | 监控指标采集使用Windows性能计数器，可视化使用本地监控工具。 | 基础设施 | 高 | 系统关键指标能被采集并在监控界面中展示。 | P2.1, P4.2 |

---
### 5. 范围边界

**范围内 (In-Scope):**

*   A股市场的日线和分钟线级别行情数据，主要来源于miniQMT。
*   Tushare Pro提供的A股财务、公司行动、估值指标及分析师评级数据，作为补充数据和行情数据的备份源。
*   从数据采集到Parquet数据发布的完整ETL管道。
*   自动化调度、质量监控、告警和故障转移机制。
*   为NautilusTrader提供数据消费的接口或文件路径。

**范围外 (Out-of-Scope):**

*   除A股外的其他市场（如港股、美股）数据。
*   分钟线以下更高频率的数据（如Tick数据）。
*   量化策略本身的开发与回测。
*   NautilusTrader系统的部署和维护。
*   实时（real-time）流处理管道的建设。本项目聚焦于批处理（batch processing）。

---